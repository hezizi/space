---
title: 'Bun 1.0'
description: 'Bunæ˜¯ä¸€ä¸ªJavaScriptè¿è¡Œæ—¶ï¼Œè½¬è¯‘å™¨ï¼Œæ„å»ºå™¨ï¼ŒåŒ…ç®¡ç†å™¨ï¼Œæµ‹è¯•ä¸€ä½“åŒ–çš„å·¥å…·åŒ…'
date: '2023-09-09'
---

> è·ç¦» Bun å‘å¸ƒçš„é¦–ä¸ªç‰ˆæœ¬æœ‰1å¹´å¤šæ—¶é—´ï¼Œå‘å¸ƒä¹‹åˆå°±å¼•èµ·å‰ç«¯ç•Œé«˜åº¦å…³æ³¨ï¼Œä¸€åº¦æˆä¸º2022å¹´æœ€å—æ¬¢è¿é¡¹ç›®ï¼Œå°±åœ¨æ˜¨å¤©ï¼ˆ9æœˆ8å·ï¼‰Bun è¿æ¥ 1.0 ç‰ˆæœ¬

### å‰ç«¯æŠ€æœ¯åœˆ

éšç€`Nodejs`çš„é—®ä¸–ï¼Œå‰ç«¯è¿›å…¥åˆ°æ–°çºªå…ƒï¼Œå‘å±•è¿…çŒ›ï¼Œå„ç±»`JavaScript`æ¡†æ¶ï¼Œ`ç¼–è¯‘` `æ‰“åŒ…` `æµ‹è¯•` `lint`ç­‰å·¥å…·å±‚å‡ºä¸ç©·ï¼Œå…±åŒæ„å»ºäº†å‰ç«¯åœˆçš„ä¸°å¯Œå¤šå½©ï¼Œ`å­¦ä¸åŠ¨äº†`å› æ­¤è€Œæ¥ğŸ™ƒã€‚

### Bunæ˜¯ä»€ä¹ˆ

å›åˆ°ä¸»é¢˜ï¼Œ`Bun`æ˜¯ä»€ä¹ˆï¼Ÿä¸€ä¸ª`JavaScript`è¿è¡Œæ—¶ï¼Œ`Transpilers`ï¼Œ`Bundlers`ï¼Œ`Package managers`ï¼Œ`Testing libraries`ä¸€ä½“åŒ–çš„å·¥å…·åŒ…ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚

### å®‰è£…å’Œæ›´æ–°

```shell
# curl
curl -fsSL https://bun.sh/install | bash

# npm
npm install -g bun

# brew
brew tap oven-sh/bun
brew install bun

# docker
docker pull oven/bun
docker run --rm --init --ulimit memlock=-1:-1 oven/bun
```

```shell
bun upgrade
```

### Bunå­˜åœ¨çš„ç›®çš„

> æ¶ˆé™¤ç¼“æ…¢å’Œå¤æ‚

1. `Nodejs`ç›´æ¥æ›¿ä»£å“ï¼Œå¯æ›¿ä»£å¯¹è±¡ï¼š

- `npx` `bunx`é€Ÿåº¦æ›´å¿«
- `nodemon` å†…ç½®ç›‘å¬æ¨¡å¼
- `dotenv`ï¼Œ`cross-env` é»˜è®¤è¯»å–`.env`æ–‡ä»¶

2. `Bun`å¯ç›´æ¥è¿è¡Œ`.js`ï¼Œ`.ts`ï¼Œ`.mjs`ï¼Œ`.cjs`ï¼Œ`jsx`ä»¥åŠ`.tsx`ï¼Œå¯æ›¿ä»£å¯¹è±¡ï¼š

- `babel`
- `tsc` ä»å¯ä½¿ç”¨tscåšç±»å‹æ£€æŸ¥
- `tsx`
- `ts-node`,`ts-node-esm`

3. `Bun`å¯æ„å»ºæ‰“åŒ…å¹¶ä¸”æ€§èƒ½æ›´é«˜ï¼Œå¯æ›¿ä»£å¯¹è±¡ï¼š`webpack`ï¼Œ`rollup`ï¼Œ`esbuild`ï¼Œ`parcel`ã€‚

4. ä¸`npm`å…¼å®¹ï¼Œä¼šè¯»å–`package.json`å°†ä¾èµ–å†™å…¥`node_modules`ï¼Œå¯æ›¿ä»£å¯¹è±¡ï¼š`npm`ï¼Œ`pnpm`ï¼Œ`yarn`ï¼Œ`lerna`ã€‚

5. å¯ç”¨äºæµ‹è¯•ï¼Œå…¼å®¹`jest`ï¼Œæ”¯æŒå¿«ç…§æµ‹è¯•ã€æ¨¡æ‹Ÿå’Œä»£ç è¦†ç›–ç‡ï¼Œå¯æ›¿ä»£å¯¹è±¡ï¼š

- `jest`,`ts-jest`,`@swc/jest`,`babel-jest`,`jest-extended`
- `vitest`

Bunä½œä¸ºä¸€ä¸ªé›†æˆå·¥å…·åŒ…é¿å…ä½¿ç”¨å¤§é‡å·¥å…·å¸¦æ¥çš„å¤æ‚å’Œä½æ•ˆé—®é¢˜

### Bunæ˜¯ä¸€ä¸ªJavaScriptè¿è¡Œæ—¶

Bunå†…ç½®äº†å¯¹Node APIçš„æ”¯æŒï¼ŒåŒ…æ‹¬ï¼š

- å†…ç½®æ¨¡å—ï¼Œå¦‚`fs`ï¼Œ`path`å’Œ`net`
- å…¨å±€å˜é‡å¦‚`__dirname`å’Œ`process`
- Node.jsæ¨¡å—è§£æç®—æ³•ï¼ˆä¾‹å¦‚`node_modules`ï¼‰

Bunå¯¹npmä¸Šæœ€æµè¡Œçš„Node.jsåŒ…çš„æµ‹è¯•å¥—ä»¶è¿›è¡Œäº†æµ‹è¯•ï¼Œ`Express`ï¼Œ`Koa`å’Œ`Hono`ç­‰æœåŠ¡å™¨æ¡†æ¶å°±å¯ä»¥æ­£å¸¸å·¥ä½œã€‚

### é€Ÿåº¦

Bunçš„å¯åŠ¨é€Ÿåº¦æ¯”Node.jså¿«4å€ï¼Œè¿™ç§å·®å¼‚åœ¨è¿è¡ŒTypeScriptæ–‡ä»¶æ—¶ä¼šå¾ˆæ˜æ˜¾ï¼ŒTypeScriptéœ€è¦å…ˆè¢«è½¬è¯‘æ‰èƒ½åœ¨Node.jsä¸­è¿è¡Œã€‚

![bun-speed](/images/bun-speed.png)

ä¸ä½¿ç”¨`Google V8`å¼•æ“æ„å»ºçš„Node.jså’Œå…¶ä»–è¿è¡Œæ—¶ä¸åŒï¼ŒBunæ˜¯ä½¿ç”¨Appleçš„`WebKit`å¼•æ“æ„å»ºçš„ï¼ŒWebKitæ˜¯ä¸ºSafariæä¾›æ”¯æŒçš„å¼•æ“ï¼Œæ¯å¤©æœ‰æ•°åäº¿å°è®¾å¤‡ä½¿ç”¨ã€‚å®ƒå¿«é€Ÿã€é«˜æ•ˆï¼Œå¹¶ä¸”ç»è¿‡äº†æ•°åå¹´çš„å®æˆ˜è€ƒéªŒã€‚

### æ”¯æŒTypeScriptå’ŒJSX

å†…ç½®äº†ä¸€ä¸ªJavaScriptè½¬è¯‘å™¨ï¼Œå¯ä»¥è¿è¡ŒJavaScriptï¼ŒTypeScriptç”šè‡³JSX/TSXæ–‡ä»¶ï¼Œæ— éœ€ä»»ä½•ä¾èµ–ï¼Œæ‰§è¡Œ`bun index.ts`æˆ–`bun index.tsx`

### ESMä¸CommonJSå…¼å®¹æ€§

ä»CommonJSå‘ESMçš„è½¬å˜ä¸€ç›´å¾ˆæ…¢ï¼Œå¹¶ä¼´éšç€è®¸å¤šé—®é¢˜ï¼ŒESMè¢«å¼•å…¥å,Node.jsèŠ±äº†5å¹´æ—¶é—´æ‰åœ¨æ— éœ€å®éªŒæ€§æ ‡è®°çš„æƒ…å†µä¸‹æ”¯æŒå®ƒï¼Œå°½ç®¡å¦‚æ­¤,ç”Ÿæ€ç³»ç»Ÿä¸­ä»æœ‰å¤§é‡CommonJSä»£ç ã€‚

BunåŒæ—¶æ”¯æŒä¸¤ç§æ¨¡å—ç³»ç»Ÿï¼Œä¸éœ€è¦æ‹…å¿ƒæ–‡ä»¶æ‰©å±•åï¼Œ`.js` vs `.cjs` vs `.mjs`ï¼Œæˆ–è€…åœ¨package.jsonä¸­åŒ…å«`"type": "module"`ã€‚

ä½ ç”šè‡³å¯ä»¥åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­åŒæ—¶ä½¿ç”¨`import`å’Œ`require()`

```js
import lodash from 'lodash'
const _ = require('underscore')
```

### Web APIs

Bunå†…ç½®æ”¯æŒäº†æµè§ˆå™¨ä¸­å¯ç”¨çš„Webæ ‡å‡† APIï¼Œæ¯”å¦‚ `fetch`ã€`Request`ã€`Response`ã€`WebSocket` å’Œ `ReadableStream`ã€‚

```js
const response = await fetch('https://example.com/')
const text = await response.text()
```

ä¸å†éœ€è¦å®‰è£…åƒ`node-fetch`å’Œ`ws`è¿™æ ·çš„åŒ…äº†ï¼ŒBunçš„å†…ç½®Web APIæ˜¯ç”¨åŸç”Ÿä»£ç å®ç°çš„ï¼Œæ¯”ç¬¬ä¸‰æ–¹æ›¿ä»£æ–¹æ¡ˆé€Ÿåº¦æ›´å¿«ã€æ›´å¯é ã€‚

### çƒ­é‡è½½

å¯ä»¥ä½¿ç”¨`--hot`è¿è¡ŒBunæ¥å¯ç”¨çƒ­é‡è½½ï¼Œå®ƒä¼šåœ¨æ–‡ä»¶æ›´æ”¹æ—¶é‡æ–°åŠ è½½åº”ç”¨ç¨‹åºã€‚

```sh
bun --hot server.ts
```

ä¸`nodemon`ä¸åŒï¼ŒBunåœ¨ä¸ç»ˆæ­¢æ—§è¿›ç¨‹çš„æƒ…å†µä¸‹é‡æ–°åŠ è½½ä½ çš„ä»£ç ï¼Œè¿™æ„å‘³ç€HTTPå’ŒWebSocketè¿æ¥ä¸ä¼šæ–­å¼€ï¼ŒçŠ¶æ€ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚

### æ’ä»¶

Buné«˜åº¦å¯å®šåˆ¶ï¼Œå¯ä»¥å®šä¹‰æ’ä»¶æ‹¦æˆªå¯¼å…¥å¹¶æ‰§è¡Œè‡ªå®šä¹‰åŠ è½½é€»è¾‘ï¼Œå¯æ·»åŠ å¯¹é¢å¤–æ–‡ä»¶ç±»å‹çš„æ”¯æŒï¼Œåƒ`.yaml`æˆ–`.png`ï¼Œå—`esbuild`å¯å‘ï¼Œæ„å‘³ç€å¤§å¤šæ•°esbuildæ’ä»¶å¯ä»¥ç›´æ¥åœ¨Bunä¸­ä½¿ç”¨ã€‚

```js
import { plugin } from "bun"

plugin({
  name: "YAML",
  async setup(build) {
    const { load } = await import("js-yaml")
    const { readFileSync } = await import("fs")
    build.onLoad({ filter: /.(yaml|yml)$/ }, (args) => {
      const text = readFileSync(args.path, "utf8")
      const exports = load(text) as Record<string, any>
      return { exports, loader: "object" }
    })
  }
})
```

### å®‰è£…é€Ÿåº¦

Bunçš„é€Ÿåº¦æ¯”`npm`ã€`yarn`ã€`pnpm`å¿«å¾ˆå¤šï¼Œå®ƒä½¿ç”¨å…¨å±€æ¨¡å—ç¼“å­˜æ¥é¿å…ä»npmæ³¨å†Œè¡¨å†—ä½™ä¸‹è½½ï¼Œå¹¶åœ¨æ¯ä¸ªæ“ä½œç³»ç»Ÿä¸Šä½¿ç”¨å¯ç”¨çš„æœ€å¿«ç³»ç»Ÿè°ƒç”¨ã€‚

![bun-install](/images/bun-install.png)

### æµ‹è¯•

Bunæœ‰ä¸€ä¸ªå†…ç½®çš„æµ‹è¯•æ¨¡å—`Bun:test`ï¼Œå®Œå…¨å…¼å®¹`Jest`ï¼Œæ‰§è¡Œ`bun test`è¿›è¡Œæµ‹è¯•ã€‚

```js
import { test, expect } from 'bun:test'

test('2 + 2', () => {
  expect(2 + 2).toBe(4)
})
```

ä»`Jest`æˆ–`Vitest`è¿ç§»å¾ˆå®¹æ˜“ï¼Œä»»ä½•æ¥è‡ª`@jest/globals`æˆ–`vitest`çš„å¯¼å…¥éƒ½å°†åœ¨å†…éƒ¨é‡æ–°æ˜ å°„åˆ°`Bun:test`ã€‚

```js
import { test } from '@jest/globals'

describe('test suite', () => {
  // ...
})
```

åœ¨é’ˆå¯¹zodæµ‹è¯•å¥—ä»¶çš„åŸºå‡†æµ‹è¯•ä¸­ï¼ŒBuné€Ÿåº¦å¿«å¾ˆå¤šã€‚

![bun-test](/images/bun-test.png)

### æ„å»ºæ‰“åŒ…

```shell
bun build ./index.tsx --outdir ./build
```

å…¼å®¹`esbuild`æ’ä»¶API

```js
import mdx from '@mdx-js/esbuild'

Bun.build({
  entrypoints: ['index.tsx'],
  outdir: 'build',
  plugins: [mdx()]
})
```

ä½¿ç”¨`esbuild`çš„åŸºå‡†æµ‹è¯•ï¼ŒBunæ‰“åŒ…é€Ÿåº¦æ¯”å…¶ä»–å·¥å…·å¿«éå¸¸å¤š

![bun-build](/images/bun-build.png)

ç”±äºBunçš„è¿è¡Œæ—¶å’Œæ†ç»‘å™¨æ˜¯é›†æˆçš„ï¼Œè¿™æ„å‘³ç€Bunå¯ä»¥åšå…¶ä»–æ†ç»‘å™¨æ— æ³•åšåˆ°çš„äº‹æƒ…ï¼Œå¼•å…¥äº†`JavaScript macros`ï¼Œè¿™æ˜¯ä¸€ç§åœ¨`bundle-time`è¿è¡ŒJavaScriptå‡½æ•°çš„æœºåˆ¶ï¼Œè¿™äº›å‡½æ•°è¿”å›çš„å€¼ç›´æ¥å†…è”åˆ°åŒ…ä¸­ã€‚

```ts
// index.ts
import { getRelease } from './release.ts' with { type: 'macro' }

// The value of `release` is evaluated at bundle-time,
// and inlined into the bundle, not run-time.
const release = await getRelease()
```

```ts
// release.ts
export async function getRelease(): Promise<string> {
  const response = await fetch(
    'https://api.github.com/repos/oven-sh/bun/releases/latest'
  )
  const { tag_name } = await response.json()
  return tag_name
}
```

### å°¾è¯­

åœ¨ç›®å‰ç™¾èŠ±é½æ”¾çš„å‰ç«¯åœˆï¼Œä¸çŸ¥`Bun`èƒ½å¦â€œé˜»æ­¢â€æ›´å¤šæ‰“åŒ…ï¼Œç¼–è¯‘ï¼Œæµ‹è¯•ç­‰å·¥å…·çš„å‡ºç°ï¼Œè°çŸ¥é“å‘¢ï¼ŸğŸ¤ªï¼ŒæœŸå¾…`Bun`åœ¨æœªæ¥èƒ½æ’¼åŠ¨`Nodejs`çš„åœ°ä½ï¼Œåƒ`Nodejs`ä¸€æ ·å¼€è¾Ÿæ–°çºªå…ƒã€‚

æ›´å¤šå†…å®¹çœ‹[Bun 1.0](https://bun.sh/blog/bun-v1.0)
